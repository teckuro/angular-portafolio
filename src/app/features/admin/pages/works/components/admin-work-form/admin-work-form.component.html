<app-admin-layout>
	<div class="work-form-container">
		<div class="page-header">
			<div class="header-content">
				<div class="header-title">
					<h1 class="page-title">
						{{ isEditMode ? 'Editar' : 'Nueva' }} Experiencia Laboral
					</h1>
					<p class="page-subtitle">
						{{
							isEditMode
								? 'Modifica los datos de la experiencia laboral'
								: 'Agrega una nueva experiencia laboral a tu portfolio'
						}}
					</p>
				</div>
			</div>
		</div>

		<!-- Loading State -->
		<div class="loading-container" *ngIf="loading">
			<div class="loading-spinner"></div>
			<p>Cargando experiencia laboral...</p>
		</div>

		<!-- Error State -->
		<div class="error-container" *ngIf="error && !loading">
			<div class="error-message">
				<span class="error-icon">⚠️</span>
				<p>{{ error }}</p>
				<button class="btn btn-secondary" (click)="onCancel()">Volver</button>
			</div>
		</div>

		<!-- Form -->
		<div class="form-content" *ngIf="!loading">
			<form [formGroup]="workForm" (ngSubmit)="onSubmit()" class="work-form">
				<!-- Información básica del trabajo -->
				<div class="form-section">
					<h3 class="section-title">Información del Trabajo</h3>
					<div class="form-grid">
						<!-- Position -->
						<div class="form-group">
							<label for="position" class="form-label">
								Cargo / Posición <span class="required">*</span>
							</label>
							<input
								type="text"
								id="position"
								formControlName="position"
								class="form-control"
								[class.invalid]="isFieldInvalid('position')"
								placeholder="Ej: Desarrollador Frontend"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('position')">
								{{ getFieldError('position') }}
							</div>
						</div>

						<!-- Company -->
						<div class="form-group">
							<label for="company" class="form-label">
								Empresa <span class="required">*</span>
							</label>
							<input
								type="text"
								id="company"
								formControlName="company"
								class="form-control"
								[class.invalid]="isFieldInvalid('company')"
								placeholder="Ej: Tech Company"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('company')">
								{{ getFieldError('company') }}
							</div>
						</div>

						<!-- Location -->
						<div class="form-group">
							<label for="location" class="form-label">
								Ubicación <span class="required">*</span>
							</label>
							<input
								type="text"
								id="location"
								formControlName="location"
								class="form-control"
								[class.invalid]="isFieldInvalid('location')"
								placeholder="Ej: Madrid, España"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('location')">
								{{ getFieldError('location') }}
							</div>
						</div>

						<!-- Status -->
						<div class="form-group">
							<label for="status" class="form-label"> Estado </label>
							<div class="custom-select-wrapper">
								<app-custom-select
									formControlName="status"
									[options]="statusOptions"
									placeholder="Seleccionar estado"
									[disabled]="workForm.get('is_current')?.value"
									[invalid]="isFieldInvalid('status')"
								></app-custom-select>
							</div>
							<div class="error-message" *ngIf="isFieldInvalid('status')">
								{{ getFieldError('status') }}
							</div>
						</div>
					</div>
				</div>

				<!-- Fechas y estado actual -->
				<div class="form-section">
					<h3 class="section-title">Período de Trabajo</h3>
					<div class="form-grid">
						<!-- Start Date -->
						<div class="form-group">
							<label for="start_date" class="form-label">
								Fecha de Inicio <span class="required">*</span>
							</label>
							<input
								type="date"
								id="start_date"
								formControlName="start_date"
								class="form-control"
								[class.invalid]="isFieldInvalid('start_date')"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('start_date')">
								{{ getFieldError('start_date') }}
							</div>
						</div>

						<!-- End Date -->
						<div
							class="form-group"
							[class.disabled]="workForm.get('is_current')?.value"
						>
							<label for="end_date" class="form-label"> Fecha de Fin </label>
							<input
								type="date"
								id="end_date"
								formControlName="end_date"
								class="form-control"
								[class.invalid]="isFieldInvalid('end_date')"
								[disabled]="workForm.get('is_current')?.value"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('end_date')">
								{{ getFieldError('end_date') }}
							</div>
						</div>

						<!-- Current Work Toggle -->
						<div class="form-group checkbox-group">
							<label class="checkbox-label">
								<input
									type="checkbox"
									formControlName="is_current"
									(change)="toggleCurrentWork()"
									class="checkbox-input"
								/>
								<span class="checkbox-text">Trabajo actual</span>
							</label>
						</div>
					</div>
				</div>

				<!-- Información adicional -->
				<div class="form-section">
					<h3 class="section-title">Información Adicional</h3>

					<!-- Description -->
					<div class="form-group full-width">
						<label for="description" class="form-label">
							Descripción <span class="required">*</span>
						</label>
						<textarea
							id="description"
							formControlName="description"
							class="form-control"
							[class.invalid]="isFieldInvalid('description')"
							rows="6"
							placeholder="Describe tus responsabilidades, logros y tecnologías utilizadas..."
						></textarea>
						<div class="error-message" *ngIf="isFieldInvalid('description')">
							{{ getFieldError('description') }}
						</div>
					</div>

					<!-- Company URL -->
					<div class="form-group full-width">
						<label for="company_url" class="form-label">
							URL de la Empresa
						</label>
						<input
							type="url"
							id="company_url"
							formControlName="company_url"
							class="form-control"
							[class.invalid]="isFieldInvalid('company_url')"
							placeholder="https://ejemplo.com"
						/>
						<div class="error-message" *ngIf="isFieldInvalid('company_url')">
							{{ getFieldError('company_url') }}
						</div>
					</div>
				</div>

				<!-- Tecnologías utilizadas -->
				<div class="form-section">
					<h3 class="section-title">Tecnologías Utilizadas</h3>
					<div class="form-group full-width">
						<label class="form-label">Tecnologías</label>
						<div class="tags-input-container">
							<div class="tags-display">
								<span
									*ngFor="
										let tech of workForm.get('tech')?.value;
										let i = index
									"
									class="tag-item"
								>
									{{ tech }}
									<button
										type="button"
										class="tag-remove"
										(click)="removeTech(i)"
									>
										×
									</button>
								</span>
							</div>
							<div class="tag-input-wrapper">
								<input
									type="text"
									#techInput
									class="tag-input"
									placeholder="Agregar tecnología (presiona Enter)"
									(keyup.enter)="addTech(techInput)"
									(keyup.space)="addTech(techInput)"
									(keyup.comma)="addTech(techInput)"
								/>
							</div>
						</div>
						<p class="form-help">
							Presiona Enter, Espacio o Coma para agregar una tecnología
						</p>
					</div>
				</div>

				<!-- Logros y logros -->
				<div class="form-section">
					<h3 class="section-title">Logros y Logros</h3>
					<div class="form-group full-width">
						<label class="form-label">Logros</label>
						<div class="achievements-container">
							<div
								*ngFor="
									let achievement of workForm.get('achievements')?.value;
									let i = index
								"
								class="achievement-item"
							>
								<div class="achievement-content">
									<span class="achievement-number">{{ i + 1 }}</span>
									<span class="achievement-text">{{ achievement }}</span>
								</div>
								<button
									type="button"
									class="achievement-remove"
									(click)="removeAchievement(i)"
								>
									×
								</button>
							</div>
							<div class="achievement-input-wrapper">
								<input
									type="text"
									#achievementInput
									class="achievement-input"
									placeholder="Agregar logro (presiona Enter)"
									(keyup.enter)="addAchievement(achievementInput)"
								/>
							</div>
						</div>
						<p class="form-help">Presiona Enter para agregar un logro</p>
					</div>
				</div>

				<!-- Form Actions -->
				<div class="form-actions">
					<button type="button" class="btn btn-secondary" (click)="onCancel()">
						Cancelar
					</button>
					<button type="submit" class="btn btn-primary" [disabled]="saving">
						<span class="btn-icon" *ngIf="saving">⏳</span>
						<span class="btn-text">
							{{
								saving ? 'Guardando...' : isEditMode ? 'Actualizar' : 'Crear'
							}}
						</span>
					</button>
				</div>
			</form>
		</div>
	</div>
</app-admin-layout>
