<app-admin-layout>
	<div class="project-form-container">
		<div class="page-header">
			<div class="header-content">
				<div class="header-title">
					<h1 class="page-title">
						{{ isEditMode ? 'Editar' : 'Nuevo' }} Proyecto
					</h1>
					<p class="page-subtitle">
						{{
							isEditMode
								? 'Modifica los datos del proyecto'
								: 'Agrega un nuevo proyecto a tu portfolio'
						}}
					</p>
				</div>
			</div>
		</div>

		<!-- Loading State -->
		<div class="loading-container" *ngIf="isLoading">
			<div class="loading-spinner"></div>
			<p>Cargando proyecto...</p>
		</div>

		<!-- Error State -->
		<div class="error-container" *ngIf="errorMessage && !isLoading">
			<div class="error-content">
				<h3>Error</h3>
				<p>{{ errorMessage }}</p>
				<button class="btn btn-secondary" (click)="onCancel()">Volver</button>
			</div>
		</div>

		<!-- Form Content -->
		<div class="form-content" *ngIf="!isLoading">
			<form
				[formGroup]="projectForm"
				(ngSubmit)="onSubmit()"
				class="project-form"
			>
				<!-- Información básica del proyecto -->
				<div class="form-section">
					<h3 class="section-title">Información del Proyecto</h3>
					<div class="form-grid">
						<!-- Title -->
						<div class="form-group full-width">
							<label for="title" class="form-label">
								Título del Proyecto <span class="required">*</span>
							</label>
							<input
								type="text"
								id="title"
								formControlName="title"
								class="form-control"
								[class.invalid]="isFieldInvalid('title')"
								placeholder="Ej: Portfolio Personal"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('title')">
								{{ getFieldError('title') }}
							</div>
						</div>

						<!-- Short Description -->
						<div class="form-group full-width">
							<label for="short_description" class="form-label">
								Descripción Corta <span class="required">*</span>
							</label>
							<input
								type="text"
								id="short_description"
								formControlName="short_description"
								class="form-control"
								[class.invalid]="isFieldInvalid('short_description')"
								placeholder="Ej: Portfolio personal con panel de administración"
							/>
							<div
								class="error-message"
								*ngIf="isFieldInvalid('short_description')"
							>
								{{ getFieldError('short_description') }}
							</div>
						</div>

						<!-- Image Upload -->
						<div class="form-group full-width">
							<app-image-upload
								formControlName="image_url"
								label="Imagen del Proyecto"
								[required]="true"
								placeholder="Selecciona una imagen para el proyecto..."
								accept="image/*"
								[maxSize]="5"
								[preview]="true"
								category="projects"
								(uploadSuccess)="onImageUploadSuccess($event)"
								(uploadError)="onImageUploadError($event)"
							></app-image-upload>
						</div>
					</div>
				</div>

				<!-- Enlaces y configuración -->
				<div class="form-section">
					<h3 class="section-title">Enlaces y Configuración</h3>
					<div class="form-grid">
						<!-- Project URL -->
						<div class="form-group">
							<label for="project_url" class="form-label">
								URL del Proyecto
							</label>
							<input
								type="url"
								id="project_url"
								formControlName="project_url"
								class="form-control"
								[class.invalid]="isFieldInvalid('project_url')"
								placeholder="https://proyecto.com"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('project_url')">
								{{ getFieldError('project_url') }}
							</div>
						</div>

						<!-- GitHub URL -->
						<div class="form-group">
							<label for="github_url" class="form-label"> URL de GitHub </label>
							<input
								type="url"
								id="github_url"
								formControlName="github_url"
								class="form-control"
								[class.invalid]="isFieldInvalid('github_url')"
								placeholder="https://github.com/user/project"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('github_url')">
								{{ getFieldError('github_url') }}
							</div>
						</div>

						<!-- Status -->
						<div class="form-group">
							<label for="status" class="form-label"> Estado </label>
							<div class="custom-select-wrapper">
								<app-custom-select
									formControlName="status"
									[options]="statusOptions"
									placeholder="Seleccionar estado"
									[invalid]="isFieldInvalid('status')"
								></app-custom-select>
							</div>
							<div class="error-message" *ngIf="isFieldInvalid('status')">
								{{ getFieldError('status') }}
							</div>
						</div>

						<!-- Order -->
						<div class="form-group">
							<label for="order" class="form-label"> Orden </label>
							<input
								type="number"
								id="order"
								formControlName="order"
								class="form-control"
								[class.invalid]="isFieldInvalid('order')"
								min="1"
							/>
							<div class="error-message" *ngIf="isFieldInvalid('order')">
								{{ getFieldError('order') }}
							</div>
						</div>

						<!-- Featured -->
						<div class="form-group checkbox-group">
							<label class="checkbox-label">
								<input
									type="checkbox"
									formControlName="is_featured"
									class="checkbox-input"
								/>
								<span class="checkbox-text">Proyecto destacado</span>
							</label>
						</div>
					</div>
				</div>

				<!-- Información detallada -->
				<div class="form-section">
					<h3 class="section-title">Información Detallada</h3>

					<!-- Description -->
					<div class="form-group full-width">
						<label for="description" class="form-label">
							Descripción Completa <span class="required">*</span>
						</label>
						<textarea
							id="description"
							formControlName="description"
							class="form-control"
							[class.invalid]="isFieldInvalid('description')"
							rows="6"
							placeholder="Describe detalladamente el proyecto, sus funcionalidades, tecnologías utilizadas..."
						></textarea>
						<div class="error-message" *ngIf="isFieldInvalid('description')">
							{{ getFieldError('description') }}
						</div>
					</div>

					<!-- Tech Stack como Tags -->
					<div class="form-group full-width">
						<label class="form-label">Tecnologías</label>
						<div class="tags-input-container">
							<div class="tags-display">
								<span
									class="tag-item"
									*ngFor="let tech of techStackArray.value; let i = index"
								>
									{{ tech }}
									<button
										type="button"
										class="tag-remove"
										(click)="removeTechTag(i)"
									>
										×
									</button>
								</span>
							</div>
							<div class="tag-input-wrapper">
								<input
									type="text"
									#techInput
									class="tag-input"
									placeholder="Agregar tecnología (presiona Enter)"
									(keydown.enter)="
										$event.preventDefault(); addTechTag(techInput)
									"
									(keyup.space)="addTechTag(techInput)"
									(keyup.comma)="addTechTag(techInput)"
								/>
							</div>
						</div>
						<p class="form-help">
							Presiona Enter, Espacio o Coma para agregar una tecnología
						</p>
					</div>

					<!-- Features como lista -->
					<div class="form-group full-width">
						<label class="form-label">Características del Proyecto</label>
						<div class="achievements-container">
							<div
								*ngFor="let feature of featuresArray.value; let i = index"
								class="achievement-item"
							>
								<div class="achievement-content">
									<span class="achievement-number">{{ i + 1 }}</span>
									<span class="achievement-text">{{ feature }}</span>
								</div>
								<button
									type="button"
									class="achievement-remove"
									(click)="removeFeatureTag(i)"
								>
									×
								</button>
							</div>
							<div class="achievement-input-wrapper">
								<input
									type="text"
									#featureInput
									class="achievement-input"
									placeholder="Agregar característica (presiona Enter)"
									(keydown.enter)="
										$event.preventDefault(); addFeatureTag(featureInput)
									"
								/>
							</div>
						</div>
						<p class="form-help">
							Presiona Enter para agregar una característica
						</p>
					</div>
				</div>

				<!-- Form Actions -->
				<div class="form-actions">
					<button type="button" class="btn btn-secondary" (click)="onCancel()">
						Cancelar
					</button>
					<button type="submit" class="btn btn-primary" [disabled]="isLoading">
						<span class="btn-icon" *ngIf="isLoading">⏳</span>
						<span class="btn-text">
							{{
								isLoading ? 'Guardando...' : isEditMode ? 'Actualizar' : 'Crear'
							}}
						</span>
					</button>
				</div>
			</form>
		</div>
	</div>
</app-admin-layout>
